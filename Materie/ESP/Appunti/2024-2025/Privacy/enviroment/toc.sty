%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE OF CONTENTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{1}{rgb}{0.7,0,0}
\definecolor{2}{rgb}{0,0.7,0}
\definecolor{3}{rgb}{0,0,0.7}
\definecolor{4}{rgb}{1,0.75,0}
\definecolor{5}{rgb}{1,0.75,0.8}
\definecolor{6}{rgb}{0,0.13, 0.38}
\definecolor{7}{rgb}{0.21,0.37,0.23}
\definecolor{8}{rgb}{0.5,0.5,0.5}

\newcommand{\ChapterColor}[1]{%
    \ifcase#1\relax
    \or \color{1}%
    \or \color{2}%
    \or \color{3}%
	\or \color{4}%
	\or \color{5}%
	\or \color{6}%
	\or \color{7}%
	\or \color{8}%
    \else \color{black}%
    \fi
}

\newcommand{\chapterColor}[1]{%
    \ifcase#1\relax
    \or 1%
    \or 2%
    \or 3%
	\or 4%
	\or 5%
	\or 6%
	\or 7%
	\or 8%
    \else black%
    \fi
}

\usepackage{tikz}
\definecolor{doc}{RGB}{0,60,110}
\usepackage{titletoc}
\contentsmargin{0cm}
\titlecontents{chapter}[3.7pc]
{\addvspace{30pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=\chapterColor{\thecontentslabel},draw=\chapterColor{\thecontentslabel}] (-7.3,-.1) rectangle (-0.5,.5);%
		\pgftext[left,x=-3.7cm,y=0.2cm]{\color{white}\Large\sc\bfseries Capitolo\ \thecontentslabel}%
	\end{tikzpicture}\ChapterColor{\thecontentslabel}\large\sc\bfseries}%
{}
{}
{\titlerule\ChapterColor{\thecontentslabel}\large\sc\bfseries Pagina \thecontentspage
	\begin{tikzpicture}[remember picture, overlay]
		\draw[fill=,draw=\chapterColor{\thecontentslabel}] (2pt,0) rectangle (4,0.1pt);
	\end{tikzpicture}}%
\titlecontents{section}[3.7pc]
{\addvspace{2pt}}
{\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]
\titlecontents*{subsection}[3.7pc]
{\addvspace{-1pt}\small}
{}
{}
{\ --- \small\thecontentspage}
[ \textbullet\ ][]

\makeatletter
\renewcommand{\chaptername}{Capitolo}
\renewcommand{\tableofcontents}{%
	\chapter*{%
	  \vspace*{-20\p@}%
	  \begin{tikzpicture}[remember picture, overlay]%
		  \pgftext[right,x=15cm,y=0.2cm]{\color{BrownPastel}\Huge\sc\bfseries \contentsname}%
		  \draw[fill=BrownPastel,draw=BrownPastel] (13,-.75) rectangle (20,1);%
		  \clip (13,-.75) rectangle (20,1);
		  \pgftext[right,x=15cm,y=0.2cm]{\color{white}\Huge\sc\bfseries \contentsname};%
	  \end{tikzpicture}}%
	\@starttoc{toc}}
\makeatother

\pdfbookmark[section]{\contentsname}{toc}
\renewcommand{\contentsname}{Indice}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SPECIAL THINGS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\setPageStyle}[1]{
    \ifnum#1=2 
        \fancyhf{}      
        \renewcommand{\headrulewidth}{0pt}
        \renewcommand{\chaptermark}[1]{{\markboth{##1}{}}}

        \fancyhead[LE]{\nouppercase{\textbf{\textcolor{\chapterColor{\thechapter}}{\chaptername}}~ \thechapter~ |~ \leftmark}}
        \fancyhead[RO]{\nouppercase{ \rightmark}}
        \fancyfoot[LE,RO]{\thepage}
        \fancypagestyle{plain}{         
        \fancyhf{}
        \fancyfoot[LE,RO]{\thepage}}    
    \else          
        \renewcommand{\headrulewidth}{0pt}
        \fancyhf{}                  
        \textcolor{red}{\fancyhead[C]{\nouppercase{ \leftmark}}}
        \fancyfoot[C]{\thepage}
    \fi
}